@using Unshackled.Kitchen.Core.Models

@inherits RecipeListBuilderBase

<MudText Typo="Typo.h6">Set Ingredient Quantities</MudText>
<ListView TItem="AddToShoppingListModel" Items="@Items" IsLoading="@IsLoading">
	<ItemRenderer>
		<MudGrid Spacing="2" Class="@GetClass(context.Item)">
			<MudItem xs="12">
				<div class="d-flex flex-row gap-x-2 align-end flex-wrap">
					<MudText Typo="Typo.subtitle1">@context.Item.ProductTitle.ToUpper()</MudText>
					<MudText>for @context.Item.IngredientTitle</MudText>
				</div>
			</MudItem>
			@if (context.Item.IsUnitMismatch) 
			{
				<MudItem xs="12">
					<MudAlert Severity="Severity.Error" NoIcon="true" Elevation="0">
						Recipe ingredient unit and product serving size unit are incompatible. The required quantity could not be calculated.
					</MudAlert>
				</MudItem>
			}
			<MudItem xs="12">
				<MudGrid Spacing="1">
					<MudItem xs="6" sm="3">
						<CaptionedProperty Title="Amount Required">
							<IngredientText Amount="@context.Item.RequiredAmount" AmountLabel="@context.Item.RequiredAmountLabel" />
						</CaptionedProperty>
					</MudItem>
					<MudItem xs="6" sm="3">
						<CaptionedProperty Title="Quantity To Add">
							<div class="d-flex gap-4 align-center flex-row">
								<MudIconButton Icon="@Icons.Material.Filled.RemoveCircleOutline" Color="Color.Secondary" Size="Size.Small" OnClick="@(() => HandleCounterSubtractClicked(context.Item))" />
								<MudText>@context.Item.Quantity</MudText>
								<MudIconButton Icon="@Icons.Material.Filled.AddCircleOutline" Color="Color.Secondary" Size="Size.Small" OnClick="@(() => HandleCounterAddClicked(context.Item))" />
							</div>
						</CaptionedProperty>
					</MudItem>
					<MudItem xs="6" sm="3">
						<CaptionedProperty Title="Quantity In List">
							<MudText>@context.Item.QuantityInList</MudText>
						</CaptionedProperty>
					</MudItem>
					<MudItem xs="6" sm="3">
						<CaptionedProperty Title="Total After Add">
							<MudText>@context.Item.TotalQuantity</MudText>
						</CaptionedProperty>
					</MudItem>
					@if (context.Item.RecipeAmounts.Any())
					{
						<MudItem xs="12">
							<div class="d-flex flex-column gap-1 mb-2">
								<MudText Typo="Typo.body2">Other Recipe Requirements: </MudText>
								@foreach (var amt in context.Item.RecipeAmounts)
								{
									<MudText Typo="Typo.body2">
										<IngredientText Amount="@amt.Amount" AmountLabel="@amt.UnitLabel" Title="@amt.RecipeTitle" />
									</MudText>
								}
							</div>
						</MudItem>
					}
				</MudGrid>
			</MudItem>
		</MudGrid>
	</ItemRenderer>
	<EmptyListRenderer>
		<MudText Align="Align.Center" Class="mt-4">Nothing to add.</MudText>
	</EmptyListRenderer>
</ListView>