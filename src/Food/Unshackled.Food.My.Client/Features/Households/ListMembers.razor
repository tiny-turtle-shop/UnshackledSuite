@inherits ListMembersBase

<SearchForm @bind-Model="@SearchModel" Class="mb-6" SearchClicked="@(() => DoSearch(1))" ResetClicked="@HandleResetClicked">
	<SearchFields>
		<MudGrid Spacing="2">
			<MudItem xs="12" sm="12">
				<MudTextField Label="Email" Variant="Variant.Outlined" FullWidth="true" Margin="Margin.Dense"
							  T="string" @bind-Value="@SearchModel.Email" Disabled="@IsLoading" />
			</MudItem>
		</MudGrid>
	</SearchFields>
</SearchForm>
<ListView TItem="MemberListModel" Items="@SearchResults.Data" IsLoading="@IsLoading" PageSize="@SearchResults.PageSize" Page="@SearchModel.Page" TotalItems="@SearchResults.Total"
		  PageSelected="@HandlePageSelected">
	<ItemRenderer>
		<MudGrid Spacing="2" Class="align-start">
			<MudItem xs="2" md="1">
				@if (!IsEditMode)
				{
					<CaptionedProperty Align="Align.Center" Title="Owner" Class="py-1">
						<YesNo ShowLabel="false" Value="@(context.Item.MemberSid == Household.MemberSid)" />
					</CaptionedProperty>
				}
				else
				{
					<MudMenu Icon="@Icons.Material.Filled.MoreVert" Disabled="@(DisableControls || context.Item.IsEditing)">
						<MudMenuItem Disabled="@(State.ActiveMember.Sid == context.Item.MemberSid)"
									 OnClick="@(() => HandleEditClicked(context.Item))">Edit</MudMenuItem>
						<MudMenuItem Disabled="@(State.ActiveMember.Sid == context.Item.MemberSid)"
									 OnClick="@(() => HandleDeleteClicked(context.Item))">Delete</MudMenuItem>
					</MudMenu>
				}
			</MudItem>
			@if (!context.Item.IsEditing)
			{

				<MudItem xs="10" md="11">
					<MudGrid Spacing="2" Class="align-center py-1">
						<MudItem xs="12" sm="8" md="9">
							<CaptionedProperty Align="Align.Start" Title="Email" Value="@context.Item.Email" />
						</MudItem>
						<MudItem xs="12" sm="4" md="3">
							<CaptionedProperty Align="Align.Start" Title="Permissions" Value="@context.Item.PermissionLevel.Title()" />
						</MudItem>
					</MudGrid>
				</MudItem>
			}
			else
			{
				<MudItem xs="10" md="11">
					<EditForm Model="@FormMember" Context="formContext" OnSubmit="@HandleFormEditSubmitted">
						<MudGrid Spacing="2" Class="align-center">
							<MudItem xs="12" md="5">
								<MudText>@EditingMember.Email</MudText>
							</MudItem>
							<MudItem xs="12" md="4">
								<PermissionLevelSelect Margin="Margin.Dense" @bind-Value="@FormMember.PermissionLevel" />
							</MudItem>
							<MudItem xs="12" md="3" Class="d-flex flex-row align-center justify-sm-end gap-1">
								<MudButton ButtonType="ButtonType.Submit" Variant="Variant.Filled" Color="Color.Primary">Update</MudButton>
								<MudButton Variant="Variant.Outlined" Color="Color.Primary" OnClick="@(() => HandleCancelEditClicked())">Cancel</MudButton>
							</MudItem>
						</MudGrid>
					</EditForm>
				</MudItem>
			}
		</MudGrid>
	</ItemRenderer>
	<EmptyListRenderer>
		<MudText Align="Align.Center" Class="mt-4">No members matched your search.</MudText>
	</EmptyListRenderer>
</ListView>

